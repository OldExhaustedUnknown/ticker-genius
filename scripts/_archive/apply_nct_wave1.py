"""NCT ID 적용 - Wave 1 (61건 대상)"""
import json
import sys
from pathlib import Path

if sys.platform == 'win32':
    sys.stdout.reconfigure(encoding='utf-8', errors='replace')

# Collected NCT IDs from web search
nct_data = {
    # Batch 1
    'KHINDIVI': [],  # No NCT found
    'CLOBETASOL': ['NCT04246801', 'NCT04249076', 'NCT04739709', 'NCT04810962', 'NCT05724446'],
    'DEXTENZA': ['NCT05626478', 'NCT04281862', 'NCT04501367', 'NCT04462523', 'NCT04529512'],
    'YARTEMLEA': ['NCT02222545', 'NCT04247906', 'NCT05855083'],
    'NARSOPLIMAB': ['NCT02222545', 'NCT04247906', 'NCT05855083'],
    'XHANCE': ['NCT01622569', 'NCT01624662', 'NCT02266927', 'NCT04242368'],
    'LENMELDY': ['NCT04283227', 'NCT01560182', 'NCT03392987'],
    'ATIDARSAGENE': ['NCT04283227', 'NCT01560182', 'NCT03392987'],
    'OC-01': ['NCT03636061', 'NCT04036292', 'NCT03873246', 'NCT05161208', 'NCT05045508'],
    'TYRVAYA': ['NCT03636061', 'NCT04036292', 'NCT03873246', 'NCT05161208', 'NCT05045508'],
    'BRAFTOVI': ['NCT01909453', 'NCT01543698', 'NCT04657991', 'NCT05270044'],
    'MEKTOVI': ['NCT01909453', 'NCT01543698', 'NCT04657991', 'NCT05270044'],
    'ENCORAFENIB': ['NCT01909453', 'NCT01543698', 'NCT04657991', 'NCT05270044'],
    'BINIMETINIB': ['NCT01909453', 'NCT01543698', 'NCT04657991', 'NCT05270044'],
    'HYMPAVZI': ['NCT03938792', 'NCT02531815', 'NCT05145127'],
    'MARSTACIMAB': ['NCT03938792', 'NCT02531815', 'NCT05145127'],
    'BEQVEZ': ['NCT02484092', 'NCT03307980', 'NCT03587116', 'NCT03861273', 'NCT05568719'],
    'FIDANACOGENE': ['NCT02484092', 'NCT03307980', 'NCT03587116', 'NCT03861273', 'NCT05568719'],

    # Batch 2
    'PAPZIMEOS': ['NCT04724980'],
    'ZOPAPOGENE': ['NCT04724980'],
    'VONOPRAZAN': ['NCT02743949', 'NCT05195528', 'NCT04028466', 'NCT04124926', 'NCT04799158'],
    'VOQUEZNA': ['NCT02743949', 'NCT05195528', 'NCT04028466', 'NCT04124926', 'NCT04799158'],
    'MOMETASONE': ['NCT01038427', 'NCT01523236', 'NCT00783237', 'NCT03879772'],
    'BARDOXOLONE': ['NCT03749447', 'NCT01351675', 'NCT00811889', 'NCT02316821', 'NCT03019185'],
    'RGX-121': ['NCT03566043', 'NCT04571970'],
    'TRIFERIC': ['NCT04689932', 'NCT01320202', 'NCT01322347', 'NCT04409132'],
    'UPNEEQ': ['NCT04831047', 'NCT02436759', 'NCT03565887', 'NCT03536949'],
    'OXYMETAZOLINE': ['NCT04831047', 'NCT02436759', 'NCT03565887', 'NCT03536949'],
    'DAXXIFY': ['NCT03014622', 'NCT03014635', 'NCT03004248', 'NCT04259086', 'NCT03786770'],
    'DAXIBOTULINUM': ['NCT03014622', 'NCT03014635', 'NCT03004248', 'NCT04259086', 'NCT03786770'],
    'FAMOTIDINE': ['NCT00229424', 'NCT01079065', 'NCT00843063'],
    'ELYXYB': ['NCT03009019', 'NCT03006276'],
    'CELECOXIB': ['NCT03009019', 'NCT03006276'],

    # Batch 3
    'FUROSCIX': ['NCT05528588', 'NCT04593823', 'NCT03458325', 'NCT04161482', 'NCT02804035'],
    'WYOST': ['NCT03974100', 'NCT01631214'],
    'ENZEEVU': ['NCT04864834'],
    'VICINEUM': ['NCT02449239', 'NCT03258593', 'NCT00462488'],
    'OPORTUZUMAB': ['NCT02449239', 'NCT03258593', 'NCT00462488'],
    'DCCR': ['NCT03440814', 'NCT03714373', 'NCT05701774', 'NCT03718416', 'NCT02034071'],
    'DIAZOXIDE': ['NCT03440814', 'NCT03714373', 'NCT05701774', 'NCT03718416', 'NCT02034071'],
    'REVUFORJ': ['NCT04065399', 'NCT05918913', 'NCT05761171'],
    'REVUMENIB': ['NCT04065399', 'NCT05918913', 'NCT05761171'],
    'EFANESOCTOCOG': ['NCT04161495', 'NCT04759131', 'NCT04644575', 'NCT03205163', 'NCT04398628'],
    'ALTUVIIIO': ['NCT04161495', 'NCT04759131', 'NCT04644575', 'NCT03205163', 'NCT04398628'],
    'FEXINIDAZOLE': ['NCT03974178', 'NCT02169557', 'NCT01685827'],
    'POZIOTINIB': ['NCT03318939', 'NCT02979821', 'NCT03066206', 'NCT05378763'],
    'ROLONTIS': ['NCT02643420', 'NCT02953340'],
    'EFLAPEGRASTIM': ['NCT02643420', 'NCT02953340'],

    # Batch 4
    'TEBIPENEM': ['NCT03788967', 'NCT06059846', 'NCT03395249', 'NCT04376554'],
    'NEFFY': [],  # Pharmacologic studies, not efficacy trials
    'APITEGROMAB': ['NCT03921528', 'NCT05156320', 'NCT05626855'],
    'SRK-015': ['NCT03921528', 'NCT05156320', 'NCT05626855'],
    'STS101': ['NCT03901482', 'NCT04406649', 'NCT03874832'],
    'ATZUMI': ['NCT03901482', 'NCT04406649', 'NCT03874832'],
    'QELBREE': ['NCT04016779', 'NCT04143217', 'NCT03247530'],
    'VILOXAZINE': ['NCT04016779', 'NCT04143217', 'NCT03247530'],
    'ONAPGO': ['NCT02006121', 'NCT02339064'],
    'SPN-830': ['NCT02006121', 'NCT02339064'],
    'GOMEKLI': ['NCT03962543', 'NCT06159166'],
    'MIRDAMETINIB': ['NCT03962543', 'NCT06159166'],
    'ENTYVIO': ['NCT00783692', 'NCT01224171', 'NCT02620046'],
    'VEDOLIZUMAB': ['NCT00783692', 'NCT01224171', 'NCT02620046'],
    'JELMYTO': ['NCT02793128', 'NCT03558503'],
    'TRADIPITANT': ['NCT02970968', 'NCT04028492', 'NCT04474990', 'NCT04849559'],

    # Batch 5
    'HETLIOZ': ['NCT01163032', 'NCT02130999'],
    'TASIMELTEON': ['NCT01163032', 'NCT02130999'],
    'BYSANTI': [],  # Not found
    'MILSAPERIDONE': [],  # Not found
    'FANAPT': ['NCT01929889', 'NCT01207414'],
    'ILOPERIDONE': ['NCT01929889', 'NCT01207414'],
    'VP-102': ['NCT03377790', 'NCT03377803'],
    'YCANTH': ['NCT03377790', 'NCT03377803'],
    'CANTHARIDIN': ['NCT03377790', 'NCT03377803'],
    'VELIGROTUG': ['NCT05176639'],  # For TED, not Fabry
    'JOURNAVX': ['NCT04977336', 'NCT05034952', 'NCT05661734', 'NCT05558410', 'NCT05553366'],
    'SUZETRIGINE': ['NCT04977336', 'NCT05034952', 'NCT05661734', 'NCT05558410', 'NCT05553366'],
    'VX-548': ['NCT04977336', 'NCT05034952', 'NCT05661734', 'NCT05558410', 'NCT05553366'],
    'ALYFTREK': ['NCT05033080', 'NCT05076149', 'NCT05444257', 'NCT05422222'],
    'VANZACAFTOR': ['NCT05033080', 'NCT05076149', 'NCT05444257', 'NCT05422222'],
    'TRIKAFTA': ['NCT03506061', 'NCT03525444', 'NCT03525548', 'NCT05279040', 'NCT05274269'],
    'ELEXACAFTOR': ['NCT03506061', 'NCT03525444', 'NCT03525548', 'NCT05279040', 'NCT05274269'],
    'KALYDECO': ['NCT02039986', 'NCT01707290', 'NCT02141464', 'NCT01784419', 'NCT01705145'],
    'IVACAFTOR': ['NCT02039986', 'NCT01707290', 'NCT02141464', 'NCT01784419', 'NCT01705145'],
    'AVMAPKI': ['NCT04625270', 'NCT06072781', 'NCT05074810', 'NCT05669482'],
    'AVUTOMETINIB': ['NCT04625270', 'NCT06072781', 'NCT05074810', 'NCT05669482'],
    'FAKZYNJA': ['NCT04625270', 'NCT06072781', 'NCT05074810', 'NCT05669482'],

    # Batch 6
    'ERMEZA': [],  # Not found
    'XOLREMDI': ['NCT03995108', 'NCT03005327'],
    'MAVORIXAFOR': ['NCT03995108', 'NCT03005327'],
    'OMBURTAMAB': ['NCT03275402', 'NCT00089245', 'NCT01099644', 'NCT01502917'],
    '8H9': ['NCT03275402', 'NCT00089245', 'NCT01099644', 'NCT01502917'],
    'DASIGLUCAGON': ['NCT03667053', 'NCT03378635', 'NCT03688711', 'NCT03984370', 'NCT03216226'],
    'ZEGALOGUE': ['NCT03667053', 'NCT03378635', 'NCT03688711', 'NCT03984370', 'NCT03216226'],
    'MIPLYFFA': ['NCT02612129', 'NCT04316637'],
    'ARIMOCLOMOL': ['NCT02612129', 'NCT04316637'],
}

data_dir = Path('data/enriched')
updated = 0
already_has = 0

for fpath in data_dir.glob('*.json'):
    with open(fpath, 'r', encoding='utf-8') as f:
        data = json.load(f)

    # Skip if already has NCT IDs
    existing_nct = data.get('nct_ids', [])
    if existing_nct and len(existing_nct) > 0:
        already_has += 1
        continue

    drug = data.get('drug_name', '').upper()
    matched_ncts = None

    for key, ncts in nct_data.items():
        if key.upper() in drug and ncts:
            matched_ncts = ncts
            break

    if matched_ncts:
        data['nct_ids'] = matched_ncts
        with open(fpath, 'w', encoding='utf-8') as f:
            json.dump(data, f, indent=2, ensure_ascii=False)
        print(f'{data.get("ticker")}: {drug[:30]} -> {len(matched_ncts)} NCTs')
        updated += 1

print(f'\nWave 1 NCT update complete')
print(f'Updated: {updated}')
print(f'Already had NCT: {already_has}')
